# Autogenerated by Chef.

<VirtualHost *:<%= node['mrtg']['http_port'] %>>
  ServerAdmin     <%= node['mrtg']['sysadmin_email'] %>
  <% if @mrtg_url %>
  ServerName <%= @mrtg_url %>
  <% else %>
  ServerName      <%= node['fqdn'] %>
  ServerAlias     mrtg mrtg.<%= node.chef_environment =~ /^_default$/ ? "default" : node.chef_environment%>.<%= @public_domain %>
  <% end %>
  DocumentRoot    <%= node['mrtg']['docroot'] %>
  CustomLog       <%= node['mrtg']['log_dir'] %>/apache_access.log combined
  ErrorLog        <%= node['mrtg']['log_dir'] %>/apache_error.log

  Alias /mrtg3 <%= node['mrtg']['docroot'] %>

  <% if @https -%>
  SSLEngine On
  SSLCertificateFile <%= @ssl_cert_file %>
  SSLCertificateKeyFile <%= @ssl_cert_key %>
  <% end -%>

<Location />
  AuthName "MRTG Server"
  AuthType Basic
  AuthUserFile "<%= node['mrtg']['conf_dir'] %>/htpasswd.users"
  require valid-user
</Location>

RewriteEngine On
  RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /.*index\.html\ HTTP/
  RewriteRule ^(.*)index\.html$ $1 [R=301,L]
</VirtualHost>
